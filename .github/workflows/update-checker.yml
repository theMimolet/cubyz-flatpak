name: Check for updates

on:
  schedule:
  - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  check-updates:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: Set up Flatpak
      run: |
        sudo apt update
        sudo apt install -y flatpak
        sudo flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo

    - name: Install flatpak-external-data-checker
      run: |
        flatpak install -y org.flathub.flatpak-external-data-checker

    - name: Check for updates
      run: |
        flatpak-external-data-checker --update io.github.pixelguys.Cubyz.yaml

    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v5
      with:
        commit-message: 'Update to latest upstream release'
        title: 'Update Cubyz to latest version'
        body: 'Automated update check found new version'
        branch: update-bot